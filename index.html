<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Campus Navigator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        #canvas-container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        .overlay {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(8px);
        }
        .building-marker {
            position: absolute;
            transform: translate(-50%, -100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .building-marker:hover {
            transform: translate(-50%, -110%) scale(1.1);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
        .path-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #3b82f6;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        .path-dot.animated {
            animation: moveDot 1.5s infinite;
        }
        @keyframes moveDot {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        .btn-primary:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-blue-50">
    <div id="canvas-container">
        <div id="loading" class="absolute inset-0 flex items-center justify-center bg-white z-50">
            <div class="text-center">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                <p class="text-xl font-medium text-gray-700">Loading Campus Map...</p>
            </div>
        </div>
        
        <!-- Search Panel -->
        <div class="absolute top-5 left-5 w-80 overlay p-4 z-10">
            <h1 class="text-xl font-bold text-blue-800 mb-3">Campus Navigator</h1>
            <div class="relative mb-4">
                <input id="search-input" type="text" placeholder="Search buildings, facilities..." 
                    class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
            </div>
            
            <div class="mb-4">
                <p class="text-sm font-medium text-gray-700 mb-2">From:</p>
                <select id="from-location" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Select starting point</option>
                    <option value="entrance">Main Entrance</option>
                    <option value="library">Library</option>
                    <option value="cafeteria">Cafeteria</option>
                    <option value="science">Science Building</option>
                    <option value="arts">Arts Center</option>
                    <option value="sports">Sports Complex</option>
                    <option value="dorms">Dormitories</option>
                    <option value="admin">Administration</option>
                </select>
            </div>
            
            <div class="mb-4">
                <p class="text-sm font-medium text-gray-700 mb-2">To:</p>
                <select id="to-location" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Select destination</option>
                    <option value="entrance">Main Entrance</option>
                    <option value="library">Library</option>
                    <option value="cafeteria">Cafeteria</option>
                    <option value="science">Science Building</option>
                    <option value="arts">Arts Center</option>
                    <option value="sports">Sports Complex</option>
                    <option value="dorms">Dormitories</option>
                    <option value="admin">Administration</option>
                </select>
            </div>
            
            <button id="navigate-btn" class="btn-primary w-full flex items-center justify-center">
                <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                Find Route
            </button>
        </div>
        
        <!-- Navigation Info Panel -->
        <div id="nav-info" class="absolute bottom-5 left-5 w-80 overlay p-4 z-10 hidden">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold text-blue-800">Navigation</h2>
                <button id="close-nav" class="text-gray-500 hover:text-gray-700">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            
            <div class="flex items-center mb-3">
                <div class="bg-blue-100 p-2 rounded-full mr-3">
                    <svg class="h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-xs text-gray-500">From</p>
                    <p id="from-display" class="font-medium">Main Entrance</p>
                </div>
            </div>
            
            <div class="flex items-center mb-3">
                <div class="bg-blue-100 p-2 rounded-full mr-3">
                    <svg class="h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-xs text-gray-500">To</p>
                    <p id="to-display" class="font-medium">Library</p>
                </div>
            </div>
            
            <div class="bg-gray-100 p-3 rounded-lg mb-3">
                <div class="flex items-center">
                    <svg class="h-5 w-5 text-blue-600 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                    </svg>
                    <span id="eta" class="font-medium">ETA: 5 minutes</span>
                </div>
                <div class="flex items-center mt-2">
                    <svg class="h-5 w-5 text-blue-600 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span id="distance" class="font-medium">Distance: 250 meters</span>
                </div>
            </div>
            
            <div id="directions" class="mb-3 max-h-40 overflow-y-auto">
                <div class="flex items-start mb-2">
                    <div class="bg-blue-500 rounded-full h-6 w-6 flex items-center justify-center text-white text-xs mr-2 mt-0.5 flex-shrink-0">1</div>
                    <p>Head east from Main Entrance towards the central plaza</p>
                </div>
                <div class="flex items-start mb-2">
                    <div class="bg-blue-500 rounded-full h-6 w-6 flex items-center justify-center text-white text-xs mr-2 mt-0.5 flex-shrink-0">2</div>
                    <p>Turn left at the fountain and continue for 100 meters</p>
                </div>
                <div class="flex items-start">
                    <div class="bg-blue-500 rounded-full h-6 w-6 flex items-center justify-center text-white text-xs mr-2 mt-0.5 flex-shrink-0">3</div>
                    <p>The Library will be on your right</p>
                </div>
            </div>
            
            <button id="reset-view" class="btn-primary w-full">
                Reset View
            </button>
        </div>
        
        <!-- Controls Panel -->
        <div class="absolute top-5 right-5 overlay p-3 z-10">
            <div class="flex space-x-2">
                <button id="zoom-in" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100">
                    <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                </button>
                <button id="zoom-out" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100">
                    <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" />
                    </svg>
                </button>
                <button id="rotate-left" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100">
                    <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </button>
                <button id="rotate-right" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100">
                    <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.293 3.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 9H9a5 5 0 00-5 5v2a1 1 0 11-2 0v-2a7 7 0 017-7h5.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Building Info Modal -->
        <div id="building-info" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 overlay p-4 z-20 hidden">
            <div class="flex justify-between items-center mb-3">
                <h2 id="building-title" class="text-lg font-bold text-blue-800">Library</h2>
                <button id="close-info" class="text-gray-500 hover:text-gray-700">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            
            <div class="bg-blue-50 rounded-lg p-3 mb-3">
                <div id="building-icon" class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-2">
                    <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
                    </svg>
                </div>
                <p id="building-description" class="text-center">The main campus library houses over 500,000 books and provides quiet study spaces for students.</p>
            </div>
            
            <div class="mb-3">
                <h3 class="font-medium mb-2">Opening Hours</h3>
                <div id="building-hours" class="grid grid-cols-2 gap-2 text-sm">
                    <div>Monday - Friday</div>
                    <div>8:00 AM - 10:00 PM</div>
                    <div>Saturday</div>
                    <div>10:00 AM - 6:00 PM</div>
                    <div>Sunday</div>
                    <div>12:00 PM - 8:00 PM</div>
                </div>
            </div>
            
            <div class="flex space-x-2">
                <button id="navigate-to-building" class="btn-primary flex-1">
                    <div class="flex items-center justify-center">
                        <svg class="h-5 w-5 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        Navigate Here
                    </div>
                </button>
                <button id="close-info-btn" class="border border-gray-300 rounded-lg px-4 hover:bg-gray-100">
                    Close
                </button>
            </div>
        </div>
        
        <!-- Legend Panel -->
        <div class="absolute bottom-5 right-5 overlay p-3 z-10">
            <h3 class="font-medium text-sm mb-2">Map Legend</h3>
            <div class="space-y-2 text-sm">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-blue-500 rounded-sm mr-2"></div>
                    <span>Academic Buildings</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-green-500 rounded-sm mr-2"></div>
                    <span>Recreation Areas</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-yellow-500 rounded-sm mr-2"></div>
                    <span>Services & Amenities</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-red-500 rounded-sm mr-2"></div>
                    <span>Residential Buildings</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-purple-500 rounded-sm mr-2"></div>
                    <span>Administration</span>
                </div>
            </div>
        </div>
        
        <!-- Dark Mode Toggle Button -->
        <button id="toggle-darkmode" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 absolute top-5 right-20 z-10" title="Toggle Dark/Light Mode">
            <svg id="darkmode-icon" class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path id="icon-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 3v1m0 16v1m8.485-8.485l-.707.707M4.222 4.222l-.707.707M21 12h-1M4 12H3m16.485 4.485l-.707-.707M4.222 19.778l-.707-.707" />
            </svg>
        </button>
    </div>

    <script>
        // Initialize the 3D scene
        let scene, camera, renderer, controls;
        let buildings = {};
        let currentPath = [];
        let pathDots = [];
        let animationFrameId;
        let currentBuilding = null;
        let isDarkMode = false;
        let ambientLight, directionalLight; // Declare at the top
        
        // Building data with coordinates and information
        const buildingData = {
            entrance: {
                position: { x: 0, z: 30 },
                color: 0x8884d8,
                name: "Main Entrance",
                description: "The primary entrance to the campus with information desk and visitor services.",
                icon: `<svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                </svg>`,
                hours: [
                    ["Monday - Friday", "7:00 AM - 9:00 PM"],
                    ["Saturday", "8:00 AM - 6:00 PM"],
                    ["Sunday", "9:00 AM - 5:00 PM"]
                ]
            },
            library: {
                position: { x: -20, z: -10 },
                color: 0x3b82f6,
                name: "Library",
                description: "The main campus library houses over 500,000 books and provides quiet study spaces for students.",
                icon: `<svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
                </svg>`,
                hours: [
                    ["Monday - Friday", "8:00 AM - 10:00 PM"],
                    ["Saturday", "10:00 AM - 6:00 PM"],
                    ["Sunday", "12:00 PM - 8:00 PM"]
                ]
            },
            cafeteria: {
                position: { x: 15, z: 5 },
                color: 0xfbbf24,
                name: "Cafeteria",
                description: "Campus dining hall offering a variety of food options for students and faculty.",
                icon: `<svg class="h-8 w-8 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" />
                </svg>`,
                hours: [
                    ["Monday - Friday", "7:00 AM - 8:00 PM"],
                    ["Saturday", "8:00 AM - 7:00 PM"],
                    ["Sunday", "9:00 AM - 6:00 PM"]
                ]
            },
            science: {
                position: { x: -15, z: 15 },
                color: 0x3b82f6,
                name: "Science Building",
                description: "Home to the science departments with modern laboratories and research facilities.",
                icon: `<svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7 2a1 1 0 00-.707 1.707L7 4.414v3.758a1 1 0 01-.293.707l-4 4C.817 14.769 2.156 18 4.828 18h10.343c2.673 0 4.012-3.231 2.122-5.121l-4-4A1 1 0 0113 8.172V4.414l.707-.707A1 1 0 0013 2H7zm2 6.172V4h2v4.172a3 3 0 00.879 2.12l1.027 1.028a4 4 0 00-2.171.102l-.47.156a4 4 0 01-2.53 0l-.563-.187a1.993 1.993 0 00-.114-.035l1.063-1.063A3 3 0 009 8.172z" clip-rule="evenodd" />
                </svg>`,
                hours: [
                    ["Monday - Friday", "7:30 AM - 9:00 PM"],
                    ["Saturday", "9:00 AM - 5:00 PM"],
                    ["Sunday", "Closed"]
                ]
            },
            arts: {
                position: { x: 25, z: -15 },
                color: 0x3b82f6,
                name: "Arts Center",
                description: "Creative hub featuring galleries, studios, and performance spaces for arts students.",
                icon: `<svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v11a3 3 0 106 0V4a2 2 0 00-2-2H4zm1 14a1 1 0 100-2 1 1 0 000 2zm5-1.757l4.9-4.9a2 2 0 000-2.828L13.485 5.1a2 2 0 00-2.828 0L10 5.757v8.486zM16 18H9.071l6-6H16a2 2 0 012 2v2a2 2 0 01-2 2z" clip-rule="evenodd" />
                </svg>`,
                hours: [
                    ["Monday - Friday", "9:00 AM - 8:00 PM"],
                    ["Saturday", "10:00 AM - 6:00 PM"],
                    ["Sunday", "12:00 PM - 5:00 PM"]
                ]
            },
            sports: {
                position: { x: -30, z: -25 },
                color: 0x10b981,
                name: "Sports Complex",
                description: "Athletic facilities including gym, swimming pool, and outdoor sports fields.",
                icon: `<svg class="h-8 w-8 text-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>`,
                hours: [
                    ["Monday - Friday", "6:00 AM - 10:00 PM"],
                    ["Saturday", "8:00 AM - 8:00 PM"],
                    ["Sunday", "8:00 AM - 8:00 PM"]
                ]
            },
            dorms: {
                position: { x: 35, z: -30 },
                color: 0xef4444,
                name: "Dormitories",
                description: "Student housing facilities with modern amenities and community spaces.",
                icon: `<svg class="h-8 w-8 text-red-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                </svg>`,
                hours: [
                    ["Access", "24/7 for residents"],
                    ["Visitor Hours", "10:00 AM - 10:00 PM"],
                    ["Quiet Hours", "11:00 PM - 7:00 AM"]
                ]
            },
            admin: {
                position: { x: 0, z: -5 },
                color: 0x8b5cf6,
                name: "Administration",
                description: "Central administrative offices including registration, financial aid, and student services.",
                icon: `<svg class="h-8 w-8 text-purple-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                </svg>`,
                hours: [
                    ["Monday - Friday", "8:30 AM - 5:00 PM"],
                    ["Saturday", "Closed"],
                    ["Sunday", "Closed"]
                ]
            }
        };
        
        // Path data between buildings
        const pathData = {
            entrance: {
                library: [
                    { x: 0, z: 20 },
                    { x: -10, z: 10 },
                    { x: -15, z: 0 },
                    { x: -20, z: -10 }
                ],
                cafeteria: [
                    { x: 0, z: 20 },
                    { x: 10, z: 15 },
                    { x: 15, z: 5 }
                ],
                science: [
                    { x: 0, z: 20 },
                    { x: -10, z: 20 },
                    { x: -15, z: 15 }
                ],
                arts: [
                    { x: 0, z: 20 },
                    { x: 10, z: 10 },
                    { x: 20, z: 0 },
                    { x: 25, z: -15 }
                ],
                sports: [
                    { x: 0, z: 20 },
                    { x: -10, z: 10 },
                    { x: -20, z: 0 },
                    { x: -30, z: -15 },
                    { x: -30, z: -25 }
                ],
                dorms: [
                    { x: 0, z: 20 },
                    { x: 10, z: 10 },
                    { x: 20, z: 0 },
                    { x: 30, z: -15 },
                    { x: 35, z: -30 }
                ],
                admin: [
                    { x: 0, z: 20 },
                    { x: 0, z: 10 },
                    { x: 0, z: -5 }
                ]
            },
            library: {
                entrance: [
                    { x: -20, z: -10 },
                    { x: -15, z: 0 },
                    { x: -10, z: 10 },
                    { x: 0, z: 20 },
                    { x: 0, z: 30 }
                ],
                cafeteria: [
                    { x: -20, z: -10 },
                    { x: -10, z: -5 },
                    { x: 0, z: 0 },
                    { x: 15, z: 5 }
                ],
                science: [
                    { x: -20, z: -10 },
                    { x: -20, z: 0 },
                    { x: -15, z: 15 }
                ],
                arts: [
                    { x: -20, z: -10 },
                    { x: -10, z: -15 },
                    { x: 0, z: -15 },
                    { x: 15, z: -15 },
                    { x: 25, z: -15 }
                ],
                sports: [
                    { x: -20, z: -10 },
                    { x: -25, z: -15 },
                    { x: -30, z: -25 }
                ],
                dorms: [
                    { x: -20, z: -10 },
                    { x: -10, z: -15 },
                    { x: 0, z: -20 },
                    { x: 15, z: -25 },
                    { x: 35, z: -30 }
                ],
                admin: [
                    { x: -20, z: -10 },
                    { x: -15, z: -5 },
                    { x: 0, z: -5 }
                ]
            },
            cafeteria: {
                entrance: [
                    { x: 15, z: 5 },
                    { x: 10, z: 15 },
                    { x: 0, z: 20 },
                    { x: 0, z: 30 }
                ],
                library: [
                    { x: 15, z: 5 },
                    { x: 0, z: 0 },
                    { x: -10, z: -5 },
                    { x: -20, z: -10 }
                ],
                science: [
                    { x: 15, z: 5 },
                    { x: 0, z: 10 },
                    { x: -15, z: 15 }
                ],
                arts: [
                    { x: 15, z: 5 },
                    { x: 20, z: 0 },
                    { x: 25, z: -15 }
                ],
                sports: [
                    { x: 15, z: 5 },
                    { x: 0, z: 0 },
                    { x: -15, z: -10 },
                    { x: -30, z: -25 }
                ],
                dorms: [
                    { x: 15, z: 5 },
                    { x: 20, z: 0 },
                    { x: 25, z: -15 },
                    { x: 35, z: -30 }
                ],
                admin: [
                    { x: 15, z: 5 },
                    { x: 10, z: 0 },
                    { x: 0, z: -5 }
                ]
            },
            science: {
                entrance: [
                    { x: -15, z: 15 },
                    { x: -10, z: 20 },
                    { x: 0, z: 20 },
                    { x: 0, z: 30 }
                ],
                library: [
                    { x: -15, z: 15 },
                    { x: -20, z: 0 },
                    { x: -20, z: -10 }
                ],
                cafeteria: [
                    { x: -15, z: 15 },
                    { x: 0, z: 10 },
                    { x: 15, z: 5 }
                ],
                arts: [
                    { x: -15, z: 15 },
                    { x: 0, z: 10 },
                    { x: 15, z: 0 },
                    { x: 25, z: -15 }
                ],
                sports: [
                    { x: -15, z: 15 },
                    { x: -20, z: 0 },
                    { x: -25, z: -15 },
                    { x: -30, z: -25 }
                ],
                dorms: [
                    { x: -15, z: 15 },
                    { x: 0, z: 10 },
                    { x: 15, z: 0 },
                    { x: 25, z: -15 },
                    { x: 35, z: -30 }
                ],
                admin: [
                    { x: -15, z: 15 },
                    { x: -10, z: 5 },
                    { x: 0, z: -5 }
                ]
            },
            arts: {
                entrance: [
                    { x: 25, z: -15 },
                    { x: 20, z: 0 },
                    { x: 10, z: 10 },
                    { x: 0, z: 20 },
                    { x: 0, z: 30 }
                ],
                library: [
                    { x: 25, z: -15 },
                    { x: 15, z: -15 },
                    { x: 0, z: -15 },
                    { x: -10, z: -15 },
                    { x: -20, z: -10 }
                ],
                cafeteria: [
                    { x: 25, z: -15 },
                    { x: 20, z: 0 },
                    { x: 15, z: 5 }
                ],
                science: [
                    { x: 25, z: -15 },
                    { x: 15, z: 0 },
                    { x: 0, z: 10 },
                    { x: -15, z: 15 }
                ],
                sports: [
                    { x: 25, z: -15 },
                    { x: 15, z: -15 },
                    { x: 0, z: -15 },
                    { x: -15, z: -20 },
                    { x: -30, z: -25 }
                ],
                dorms: [
                    { x: 25, z: -15 },
                    { x: 30, z: -25 },
                    { x: 35, z: -30 }
                ],
                admin: [
                    { x: 25, z: -15 },
                    { x: 15, z: -10 },
                    { x: 0, z: -5 }
                ]
            },
            sports: {
                entrance: [
                    { x: -30, z: -25 },
                    { x: -30, z: -15 },
                    { x: -20, z: 0 },
                    { x: -10, z: 10 },
                    { x: 0, z: 20 },
                    { x: 0, z: 30 }
                ],
                library: [
                    { x: -30, z: -25 },
                    { x: -25, z: -15 },
                    { x: -20, z: -10 }
                ],
                cafeteria: [
                    { x: -30, z: -25 },
                    { x: -15, z: -10 },
                    { x: 0, z: 0 },
                    { x: 15, z: 5 }
                ],
                science: [
                    { x: -30, z: -25 },
                    { x: -25, z: -15 },
                    { x: -20, z: 0 },
                    { x: -15, z: 15 }
                ],
                arts: [
                    { x: -30, z: -25 },
                    { x: -15, z: -20 },
                    { x: 0, z: -15 },
                    { x: 15, z: -15 },
                    { x: 25, z: -15 }
                ],
                dorms: [
                    { x: -30, z: -25 },
                    { x: -15, z: -25 },
                    { x: 0, z: -25 },
                    { x: 15, z: -25 },
                    { x: 35, z: -30 }
                ],
                admin: [
                    { x: -30, z: -25 },
                    { x: -20, z: -15 },
                    { x: -10, z: -10 },
                    { x: 0, z: -5 }
                ]
            },
            dorms: {
                entrance: [
                    { x: 35, z: -30 },
                    { x: 30, z: -15 },
                    { x: 20, z: 0 },
                    { x: 10, z: 10 },
                    { x: 0, z: 20 },
                    { x: 0, z: 30 }
                ],
                library: [
                    { x: 35, z: -30 },
                    { x: 15, z: -25 },
                    { x: 0, z: -20 },
                    { x: -10, z: -15 },
                    { x: -20, z: -10 }
                ],
                cafeteria: [
                    { x: 35, z: -30 },
                    { x: 25, z: -15 },
                    { x: 20, z: 0 },
                    { x: 15, z: 5 }
                ],
                science: [
                    { x: 35, z: -30 },
                    { x: 25, z: -15 },
                    { x: 15, z: 0 },
                    { x: 0, z: 10 },
                    { x: -15, z: 15 }
                ],
                arts: [
                    { x: 35, z: -30 },
                    { x: 30, z: -25 },
                    { x: 25, z: -15 }
                ],
                sports: [
                    { x: 35, z: -30 },
                    { x: 15, z: -25 },
                    { x: 0, z: -25 },
                    { x: -15, z: -25 },
                    { x: -30, z: -25 }
                ],
                admin: [
                    { x: 35, z: -30 },
                    { x: 20, z: -20 },
                    { x: 10, z: -10 },
                    { x: 0, z: -5 }
                ]
            },
            admin: {
                entrance: [
                    { x: 0, z: -5 },
                    { x: 0, z: 10 },
                    { x: 0, z: 20 },
                    { x: 0, z: 30 }
                ],
                library: [
                    { x: 0, z: -5 },
                    { x: -15, z: -5 },
                    { x: -20, z: -10 }
                ],
                cafeteria: [
                    { x: 0, z: -5 },
                    { x: 10, z: 0 },
                    { x: 15, z: 5 }
                ],
                science: [
                    { x: 0, z: -5 },
                    { x: -10, z: 5 },
                    { x: -15, z: 15 }
                ],
                arts: [
                    { x: 0, z: -5 },
                    { x: 15, z: -10 },
                    { x: 25, z: -15 }
                ],
                sports: [
                    { x: 0, z: -5 },
                    { x: -10, z: -10 },
                    { x: -20, z: -15 },
                    { x: -30, z: -25 }
                ],
                dorms: [
                    { x: 0, z: -5 },
                    { x: 10, z: -10 },
                    { x: 20, z: -20 },
                    { x: 35, z: -30 }
                ]
            }
        };
        
        // Directions text for navigation
        const directionsText = {
            entrance: {
                library: [
                    "Head south from Main Entrance",
                    "Turn left at the central plaza",
                    "Continue past the fountain for 150 meters",
                    "The Library will be on your right"
                ],
                cafeteria: [
                    "Head south from Main Entrance",
                    "Turn right at the central plaza",
                    "The Cafeteria will be straight ahead"
                ],
                science: [
                    "Head south from Main Entrance",
                    "Turn left at the central plaza",
                    "The Science Building will be on your left"
                ],
                arts: [
                    "Head south from Main Entrance",
                    "Turn right at the central plaza",
                    "Follow the path past the pond",
                    "The Arts Center will be straight ahead"
                ],
                sports: [
                    "Head south from Main Entrance",
                    "Turn left at the central plaza",
                    "Follow the path past the library",
                    "Continue straight for 200 meters",
                    "The Sports Complex will be on your left"
                ],
                dorms: [
                    "Head south from Main Entrance",
                    "Turn right at the central plaza",
                    "Follow the path past the pond",
                    "Continue straight for 300 meters",
                    "The Dormitories will be on your right"
                ],
                admin: [
                    "Head south from Main Entrance",
                    "Continue straight for 150 meters",
                    "The Administration Building will be directly ahead"
                ]
            },
            library: {
                entrance: [
                    "Exit the Library and head north",
                    "Turn right at the fountain",
                    "Continue straight for 150 meters",
                    "The Main Entrance will be straight ahead"
                ],
                cafeteria: [
                    "Exit the Library and head northeast",
                    "Cross the central plaza",
                    "The Cafeteria will be on your left"
                ],
                science: [
                    "Exit the Library and head north",
                    "Turn left at the fountain",
                    "The Science Building will be straight ahead"
                ],
                arts: [
                    "Exit the Library and head east",
                    "Follow the path past the pond",
                    "The Arts Center will be on your right"
                ],
                sports: [
                    "Exit the Library and head southwest",
                    "Follow the path for 100 meters",
                    "The Sports Complex will be straight ahead"
                ],
                dorms: [
                    "Exit the Library and head southeast",
                    "Follow the path past the pond",
                    "Continue straight for 250 meters",
                    "The Dormitories will be on your right"
                ],
                admin: [
                    "Exit the Library and head east",
                    "Follow the path for 100 meters",
                    "The Administration Building will be straight ahead"
                ]
            },
            cafeteria: {
                entrance: [
                    "Exit the Cafeteria and head northwest",
                    "Cross the central plaza",
                    "Continue straight for 150 meters",
                    "The Main Entrance will be straight ahead"
                ],
                library: [
                    "Exit the Cafeteria and head southwest",
                    "Cross the central plaza",
                    "The Library will be on your left"
                ],
                science: [
                    "Exit the Cafeteria and head west",
                    "Cross the central plaza",
                    "The Science Building will be straight ahead"
                ],
                arts: [
                    "Exit the Cafeteria and head south",
                    "Follow the path for 150 meters",
                    "The Arts Center will be straight ahead"
                ],
                sports: [
                    "Exit the Cafeteria and head southwest",
                    "Follow the path past the library",
                    "The Sports Complex will be on your left"
                ],
                dorms: [
                    "Exit the Cafeteria and head south",
                    "Follow the path for 250 meters",
                    "The Dormitories will be straight ahead"
                ],
                admin: [
                    "Exit the Cafeteria and head south",
                    "Follow the path for 100 meters",
                    "The Administration Building will be on your right"
                ]
            },
            science: {
                entrance: [
                    "Exit the Science Building and head north",
                    "Turn right at the intersection",
                    "Continue straight for 150 meters",
                    "The Main Entrance will be straight ahead"
                ],
                library: [
                    "Exit the Science Building and head south",
                    "Follow the path for 150 meters",
                    "The Library will be on your right"
                ],
                cafeteria: [
                    "Exit the Science Building and head east",
                    "Cross the central plaza",
                    "The Cafeteria will be straight ahead"
                ],
                arts: [
                    "Exit the Science Building and head southeast",
                    "Cross the central plaza",
                    "Follow the path past the pond",
                    "The Arts Center will be on your right"
                ],
                sports: [
                    "Exit the Science Building and head south",
                    "Follow the path past the library",
                    "The Sports Complex will be on your left"
                ],
                dorms: [
                    "Exit the Science Building and head southeast",
                    "Cross the central plaza",
                    "Follow the path past the pond",
                    "Continue straight for 200 meters",
                    "The Dormitories will be on your right"
                ],
                admin: [
                    "Exit the Science Building and head southeast",
                    "Follow the path for 150 meters",
                    "The Administration Building will be straight ahead"
                ]
            },
            arts: {
                entrance: [
                    "Exit the Arts Center and head northwest",
                    "Follow the path past the pond",
                    "Cross the central plaza",
                    "Continue straight for 150 meters",
                    "The Main Entrance will be straight ahead"
                ],
                library: [
                    "Exit the Arts Center and head west",
                    "Follow the path for 200 meters",
                    "The Library will be on your left"
                ],
                cafeteria: [
                    "Exit the Arts Center and head north",
                    "Follow the path for 150 meters",
                    "The Cafeteria will be straight ahead"
                ],
                science: [
                    "Exit the Arts Center and head northwest",
                    "Follow the path past the pond",
                    "Cross the central plaza",
                    "The Science Building will be on your left"
                ],
                sports: [
                    "Exit the Arts Center and head west",
                    "Follow the path for 300 meters",
                    "The Sports Complex will be on your left"
                ],
                dorms: [
                    "Exit the Arts Center and head southwest",
                    "Follow the path for 100 meters",
                    "The Dormitories will be straight ahead"
                ],
                admin: [
                    "Exit the Arts Center and head northwest",
                    "Follow the path for 150 meters",
                    "The Administration Building will be on your right"
                ]
            },
            sports: {
                entrance: [
                    "Exit the Sports Complex and head northeast",
                    "Follow the path past the library",
                    "Cross the central plaza",
                    "Continue straight for 150 meters",
                    "The Main Entrance will be straight ahead"
                ],
                library: [
                    "Exit the Sports Complex and head northeast",
                    "Follow the path for 100 meters",
                    "The Library will be on your right"
                ],
                cafeteria: [
                    "Exit the Sports Complex and head northeast",
                    "Follow the path past the library",
                    "Cross the central plaza",
                    "The Cafeteria will be on your right"
                ],
                science: [
                    "Exit the Sports Complex and head north",
                    "Follow the path past the library",
                    "The Science Building will be on your right"
                ],
                arts: [
                    "Exit the Sports Complex and head east",
                    "Follow the path for 300 meters",
                    "The Arts Center will be straight ahead"
                ],
                dorms: [
                    "Exit the Sports Complex and head east",
                    "Follow the path for 400 meters",
                    "The Dormitories will be on your right"
                ],
                admin: [
                    "Exit the Sports Complex and head northeast",
                    "Follow the path for 200 meters",
                    "The Administration Building will be on your right"
                ]
            },
            dorms: {
                entrance: [
                    "Exit the Dormitories and head northwest",
                    "Follow the path past the Arts Center",
                    "Cross the central plaza",
                    "Continue straight for 150 meters",
                    "The Main Entrance will be straight ahead"
                ],
                library: [
                    "Exit the Dormitories and head northwest",
                    "Follow the path for 250 meters",
                    "The Library will be on your left"
                ],
                cafeteria: [
                    "Exit the Dormitories and head north",
                    "Follow the path past the Arts Center",
                    "The Cafeteria will be straight ahead"
                ],
                science: [
                    "Exit the Dormitories and head northwest",
                    "Follow the path past the Arts Center",
                    "Cross the central plaza",
                    "The Science Building will be on your left"
                ],
                arts: [
                    "Exit the Dormitories and head northeast",
                    "Follow the path for 100 meters",
                    "The Arts Center will be straight ahead"
                ],
                sports: [
                    "Exit the Dormitories and head west",
                    "Follow the path for 400 meters",
                    "The Sports Complex will be on your left"
                ],
                admin: [
                    "Exit the Dormitories and head northwest",
                    "Follow the path for 200 meters",
                    "The Administration Building will be on your right"
                ]
            },
            admin: {
                entrance: [
                    "Exit the Administration Building and head north",
                    "Continue straight for 300 meters",
                    "The Main Entrance will be straight ahead"
                ],
                library: [
                    "Exit the Administration Building and head west",
                    "Follow the path for 100 meters",
                    "The Library will be straight ahead"
                ],
                cafeteria: [
                    "Exit the Administration Building and head north",
                    "Follow the path for 100 meters",
                    "The Cafeteria will be on your left"
                ],
                science: [
                    "Exit the Administration Building and head northwest",
                    "Follow the path for 150 meters",
                    "The Science Building will be straight ahead"
                ],
                arts: [
                    "Exit the Administration Building and head southeast",
                    "Follow the path for 150 meters",
                    "The Arts Center will be straight ahead"
                ],
                sports: [
                    "Exit the Administration Building and head southwest",
                    "Follow the path for 200 meters",
                    "The Sports Complex will be straight ahead"
                ],
                dorms: [
                    "Exit the Administration Building and head southeast",
                    "Follow the path for 200 meters",
                    "The Dormitories will be straight ahead"
                ]
            }
        };
        
        // Add trees to the scene
        function addTrees() {
            for (let i = 0; i < 20; i++) {
                const treeGeometry = new THREE.CylinderGeometry(0.8, 1.2, 6, 8);
                const treeMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22 });
                const tree = new THREE.Mesh(treeGeometry, treeMaterial);
                tree.position.set(
                    Math.random() * 180 - 90,
                    3,
                    Math.random() * 180 - 90
                );
                scene.add(tree);
            }
        }
        
        // Initialize the scene
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f9ff); // Light blue sky
            
            // Create camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 50, 50);
            camera.lookAt(0, 0, 0);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Add ambient light
            ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            // Add directional light (sunlight)
            directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Create ground
            const groundGeometry = new THREE.PlaneGeometry(200, 200);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x7cad7c,
                roughness: 0.8,
                metalness: 0.2
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -0.5;
            scene.add(ground);
            
            // Create paths
            createPaths();
            
            // Create buildings
            createBuildings();
            
            // Create building markers
            createBuildingMarkers();
            
            // Add trees
            addTrees();
            
            // Add event listeners
            window.addEventListener('resize', onWindowResize);
            
            // Add controls
            document.getElementById('zoom-in').addEventListener('click', () => {
                if (camera.position.y > 20) {
                    camera.position.y -= 10;
                    camera.position.z -= 10;
                }
            });
            
            document.getElementById('zoom-out').addEventListener('click', () => {
                if (camera.position.y < 100) {
                    camera.position.y += 10;
                    camera.position.z += 10;
                }
            });
            
            document.getElementById('rotate-left').addEventListener('click', () => {
                rotateCamera(-Math.PI / 12);
            });
            
            document.getElementById('rotate-right').addEventListener('click', () => {
                rotateCamera(Math.PI / 12);
            });
            
            document.getElementById('navigate-btn').addEventListener('click', findRoute);
            document.getElementById('close-nav').addEventListener('click', () => {
                document.getElementById('nav-info').classList.add('hidden');
                clearPath();
            });
            
            document.getElementById('reset-view').addEventListener('click', () => {
                camera.position.set(0, 50, 50);
                camera.lookAt(0, 0, 0);
            });
            
            document.getElementById('close-info').addEventListener('click', () => {
                document.getElementById('building-info').classList.add('hidden');
            });
            
            document.getElementById('close-info-btn').addEventListener('click', () => {
                document.getElementById('building-info').classList.add('hidden');
            });
            
            document.getElementById('navigate-to-building').addEventListener('click', () => {
                if (currentBuilding) {
                    document.getElementById('to-location').value = currentBuilding;
                    document.getElementById('building-info').classList.add('hidden');
                    findRoute();
                }
            });
            
            // Search functionality
            document.getElementById('search-input').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                
                if (searchTerm.length < 2) return;
                
                for (const [id, data] of Object.entries(buildingData)) {
                    if (data.name.toLowerCase().includes(searchTerm) || 
                        data.description.toLowerCase().includes(searchTerm)) {
                        // Highlight building
                        const building = buildings[id];
                        building.material.emissive.set(0xffff00);
                        building.material.emissiveIntensity = 0.5;
                        
                        // Reset after 2 seconds
                        setTimeout(() => {
                            building.material.emissive.set(0x000000);
                            building.material.emissiveIntensity = 0;
                        }, 2000);
                    }
                }
            });
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1500);
            
            // Start animation loop
            animate();
        }
        
        // Create buildings
        function createBuildings() {
            for (const [id, data] of Object.entries(buildingData)) {
                let geometry;
                if (id === "library") {
                    geometry = new THREE.BoxGeometry(18, 12, 12);
                } else if (id === "cafeteria") {
                    geometry = new THREE.CylinderGeometry(7, 7, 6, 32);
                } else if (id === "sports") {
                    geometry = new THREE.BoxGeometry(24, 8, 14);
                } else if (id === "dorms") {
                    geometry = new THREE.BoxGeometry(16, 16, 8);
                } else {
                    geometry = new THREE.BoxGeometry(10, 10, 10);
                }
                const material = new THREE.MeshStandardMaterial({
                    color: data.color,
                    roughness: 0.7,
                    metalness: 0.3
                });
                const building = new THREE.Mesh(geometry, material);
                building.position.set(data.position.x, geometry.parameters.height / 2 || 5, data.position.z);
                scene.add(building);
                buildings[id] = building;
            }
        }
        
        // Create paths between buildings
        function createPaths() {
            const pathMaterial = new THREE.LineBasicMaterial({ color: 0xd1d5db, linewidth: 2 });
            
            for (const [fromId, destinations] of Object.entries(pathData)) {
                for (const [toId, points] of Object.entries(destinations)) {
                    const pathPoints = [];
                    
                    // Add starting point (from building)
                    const fromPos = buildingData[fromId].position;
                    pathPoints.push(new THREE.Vector3(fromPos.x, 0.1, fromPos.z));
                    
                    // Add intermediate points
                    for (const point of points) {
                        pathPoints.push(new THREE.Vector3(point.x, 0.1, point.z));
                    }
                    
                    // Add ending point (to building)
                    const toPos = buildingData[toId].position;
                    pathPoints.push(new THREE.Vector3(toPos.x, 0.1, toPos.z));
                    
                    // Create path
                    const pathGeometry = new THREE.BufferGeometry().setFromPoints(pathPoints);
                    const path = new THREE.Line(pathGeometry, pathMaterial);
                    scene.add(path);
                }
            }
        }
        
        // Create building markers
        function createBuildingMarkers() {
            for (const [id, data] of Object.entries(buildingData)) {
                const marker = document.createElement('div');
                marker.className = 'building-marker';
                marker.innerHTML = `
                    <div class="flex flex-col items-center">
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg pulse">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <svg class="h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                        <div class="bg-white px-2 py-1 rounded-lg shadow-md mt-1 text-xs font-medium">
                            ${data.name}
                        </div>
                    </div>
                `;
                
                document.getElementById('canvas-container').appendChild(marker);
                
                // Add click event
                marker.addEventListener('click', () => {
                    showBuildingInfo(id);
                });
                
                // Store reference to update position
                marker.dataset.buildingId = id;
            }
        }
        
        // Update marker positions
        function updateMarkerPositions() {
            const markers = document.querySelectorAll('.building-marker');
            
            markers.forEach(marker => {
                const id = marker.dataset.buildingId;
                const building = buildings[id];
                
                if (building) {
                    const vector = new THREE.Vector3();
                    vector.setFromMatrixPosition(building.matrixWorld);
                    vector.project(camera);
                    
                    const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (vector.y * -0.5 + 0.5) * window.innerHeight;
                    
                    marker.style.transform = `translate(-50%, -100%) translate(${x}px, ${y}px)`;
                    
                    // Hide if behind camera
                    if (vector.z > 1) {
                        marker.style.display = 'none';
                    } else {
                        marker.style.display = 'block';
                    }
                }
            });
            
            // Update path dots
            updatePathDots();
        }
        
        // Show building info
        function showBuildingInfo(id) {
            const data = buildingData[id];
            
            document.getElementById('building-title').textContent = data.name;
            document.getElementById('building-description').textContent = data.description;
            document.getElementById('building-icon').innerHTML = data.icon;
            
            // Update hours
            const hoursContainer = document.getElementById('building-hours');
            hoursContainer.innerHTML = '';
            
            data.hours.forEach(([day, hours]) => {
                hoursContainer.innerHTML += `
                    <div>${day}</div>
                    <div>${hours}</div>
                `;
            });
            
            // Store current building
            currentBuilding = id;
            
            // Show modal
            document.getElementById('building-info').classList.remove('hidden');
        }
        
        // Find route between buildings
        function findRoute() {
            const fromLocation = document.getElementById('from-location').value;
            const toLocation = document.getElementById('to-location').value;
            
            if (!fromLocation || !toLocation || fromLocation === toLocation) {
                return;
            }
            
            // Clear previous path
            clearPath();
            
            // Get path points
            const pathPoints = pathData[fromLocation][toLocation];
            const fromPos = buildingData[fromLocation].position;
            const toPos = buildingData[toLocation].position;
            
            // Create path dots
            createPathDots([
                { x: fromPos.x, z: fromPos.z },
                ...pathPoints,
                { x: toPos.x, z: toPos.z }
            ]);
            
            // Update navigation info
            document.getElementById('from-display').textContent = buildingData[fromLocation].name;
            document.getElementById('to-display').textContent = buildingData[toLocation].name;
            
            // Calculate distance and ETA
            let totalDistance = 0;
            let prevPoint = { x: fromPos.x, z: fromPos.z };
            
            for (const point of pathPoints) {
                const dx = point.x - prevPoint.x;
                const dz = point.z - prevPoint.z;
                totalDistance += Math.sqrt(dx * dx + dz * dz);
                prevPoint = point;
            }
            
            const dx = toPos.x - prevPoint.x;
            const dz = toPos.z - prevPoint.z;
            
           
            // 1 unit = 1 meter, walking speed = 1.4 m/s
            const timeInSeconds = totalDistance / 1.4;
            const minutes = Math.ceil(timeInSeconds / 60);
            
            document.getElementById('distance').textContent = `Distance: ${Math.round(totalDistance)} meters`;
            document.getElementById('eta').textContent = `ETA: ${minutes} minute${minutes !== 1 ? 's' : ''}`;
            
            // Update directions
           
            const directionsContainer = document.getElementById('directions');
            directionsContainer.innerHTML = '';
            
            const directions = directionsText[fromLocation][toLocation];
            directions.forEach((text, index) => {
                directionsContainer.innerHTML += `
                    <div class="flex items-start mb-2">
                        <div class="bg-blue-500 rounded-full h-6 w-6 flex items-center justify-center text-white text-xs mr-2 mt-0.5 flex-shrink-0">${index + 1}</div>
                        <p>${text}</p>
                    </div>
                `;
            });
            
            // Show navigation panel
            document.getElementById('nav-info').classList.remove('hidden');
            
            // Focus camera on path
            focusCameraOnPath(fromPos, toPos);
        }
        
        // Create path dots
        function createPathDots(points) {
            // Clear previous dots
            clearPath();
            
            // Store current path
            currentPath = points;
            
            // Create dots
            for (let i = 0; i < points.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'path-dot';
                
                // Animate some dots
                if (i % 3 === 0) {
                    dot.classList.add('animated');
                }
                
                document.getElementById('canvas-container').appendChild(dot);
                pathDots.push(dot);
            }
        }
        
        // Update path dots positions
        function updatePathDots() {
            if (currentPath.length === 0 || pathDots.length === 0) {
                return;
            }
            
            for (let i = 0; i < currentPath.length; i++) {
                const point = currentPath[i];
                const dot = pathDots[i];
                
                const vector = new THREE.Vector3(point.x, 0.1, point.z);
                vector.project(camera);
                
                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = (vector.y * -0.5 + 0.5) * window.innerHeight;
                
                dot.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px)`;
                
                // Hide if behind camera
                if (vector.z > 1) {
                    dot.style.display = 'none';
                } else {
                    dot.style.display = 'block';
                }
            }
        }
        
        // Clear path
        function clearPath() {
            pathDots.forEach(dot => {
                dot.remove();
            });
            
            pathDots = [];
            currentPath = [];
        }
        
        // Focus camera on path
        function focusCameraOnPath(fromPos, toPos) {
            const midX = (fromPos.x + toPos.x) / 2;
            const midZ = (fromPos.z + toPos.z) / 2;

            const dx = fromPos.x - toPos.x;
            const dz = fromPos.z - toPos.z;
            const distance = Math.sqrt(dx * dx + dz * dz);

            // Adjust camera position based on path length
            camera.position.set(midX, Math.max(30, distance), midZ + Math.max(30, distance));
            camera.lookAt(midX, 0, midZ);
        }

        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Animation loop
        function animate() {
            animationFrameId = requestAnimationFrame(animate);

            // Update marker positions
            updateMarkerPositions();

            // Render scene
            renderer.render(scene, camera);
        }

        // Start everything
        init();

        function setNightMode(isNight) {
            scene.background = new THREE.Color(isNight ? 0x22223b : 0xf0f9ff);
            ambientLight.intensity = isNight ? 0.2 : 0.6;
            directionalLight.intensity = isNight ? 0.3 : 0.8;
        }

    </script>
</body>
</html>
